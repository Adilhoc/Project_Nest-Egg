<!DOCTYPE html>
<html lang="en">
<head>
    <a href="./trading.html"
   class="px-3 py-2 rounded-lg border border-[#2F2F2F] hover:bg-[#252525] text-sm">
  Trading Dashboard
</a>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Mandate: Project Nest Egg</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sticky-sidebar { position: sticky; top: 2rem; align-self: start; }
        .toggle-btn { transition: all 0.2s ease-in-out; }
        .toggle-btn.active { background-color: #3B82F6; color: white; border-color: #3B82F6; }
        .toggle-btn:not(.active):hover { background-color: #F3F4F6; }
        
        /* Chat Widget Animations */
        .chat-enter { animation: slideIn 0.3s ease-out forwards; }
        .chat-exit { animation: slideOut 0.3s ease-in forwards; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(20px); opacity: 0; } }
        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

    <!-- Top Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white mr-3 shadow-lg">
                        <i class="fas fa-shield-alt text-xl"></i>
                    </div>
                    <div>
                        <span class="font-bold text-xl tracking-tight text-gray-900 block leading-none">Project Nest Egg</span>
                        <span class="text-xs text-gray-500 font-medium">Wealth Preservation Mandate</span>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-3">
                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-50 text-blue-700 border border-blue-100">
                        <i class="fas fa-user-shield mr-1"></i> Capital Protection <span class="font-normal opacity-75">(Safety First)</span>
                    </span>
                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-green-50 text-green-700 border border-green-100">
                        <i class="fas fa-chart-line mr-1"></i> Market Beating <span class="font-normal opacity-75">(High Growth)</span>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- Left Column: Main Content -->
            <div class="flex-1 min-w-0">
                
                <!-- Executive Summary -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-8">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 rounded-xl bg-indigo-50 flex items-center justify-center text-indigo-600 mr-4">
                            <i class="fas fa-file-signature text-2xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900">Executive Summary: The "50-30-20 Shield"</h2>
                    </div>
                    <p class="text-gray-600 text-lg leading-relaxed mb-4">
                        We have designed a custom strategy that balances your need for <strong>Capital Protection</strong> 
                        <span class="text-gray-400 italic text-sm">(keeping the inheritance intact in real terms)</span> with 
                        <strong>Market-Beating Growth</strong> 
                        <span class="text-gray-400 italic text-sm">(aiming to outpace inflation and standard bank deposits over a decade)</span>. 
                        The solution is a disciplined, rules-based portfolio that does not rely on stock picking or timing the market.
                    </p>
                    <p class="text-gray-600 text-lg leading-relaxed mb-4">
                        Instead of investing all your money at once (lumpsum), which is risky if the market corrects immediately after, 
                        we use a <strong>12-Month Systematic Transfer Plan (STP)</strong>. Think of this as slowly "dripping" your money 
                        into the market month-by-month to average out the purchase price. You still remain invested – but in a low-risk 
                        arbitrage fund initially – and only then migrate into equity as the STP runs, allowing both your return expectations 
                        and your comfort with risk to stay aligned.
                    </p>
                    <p class="text-gray-600 text-base leading-relaxed mb-6">
                        The final structure is simple but powerful: <strong>50% in Nifty 50</strong> as the core stability anchor, 
                        <strong>30% in Nifty Next 50</strong> as the growth engine, and <strong>20% in Gold</strong> as the crisis hedge. 
                        This 50-30-20 blend is backed by data from 2020–2025 and is designed to keep your downside shallower than pure equity, 
                        while still allowing the portfolio to ride India's long-term economic growth.
                    </p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <p class="text-blue-900 font-medium">
                            <i class="fas fa-lightbulb text-blue-500 mr-2"></i> 
                            <strong>Why STP?</strong> By spreading investments over 12 months, we buy more units when markets are down 
                            (cheap) and fewer when they are up (expensive). This reduces the risk of \"bad timing\" and the emotional regret 
                            that often causes investors to abandon good strategies at exactly the wrong time.
                        </p>
                    </div>
                </div>

                <!-- ✨  Scenario Stress Test -->
                <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl shadow-lg p-1 border border-slate-700 mb-8">
                    <div class="bg-slate-900/50 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <i class="fas fa-sparkles text-yellow-400 mr-2"></i> Scenario Stress-Test
                            </h3>
                            <span class="text-xs font-mono bg-slate-800 text-slate-400 px-2 py-1 rounded">Powered by Gemini</span>
                        </div>
                        <p class="text-slate-300 text-sm mb-4">
                            Not sure how this portfolio will perform in a crisis? Type a scenario below (e.g., "Global Recession", "War in Europe", "Interest Rates Hike"), and our model will analyze the resilience of the <strong>50-30-20 Shield</strong>.
                        </p>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="scenarioInput" placeholder="E.g., What if the Rupee crashes vs Dollar?" 
                                class="flex-1 bg-slate-800 border border-slate-600 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder-slate-500 transition-all">
                            <button onclick="analyzeScenario()" id="scenarioBtn" 
                                class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-semibold transition-colors flex items-center">
                                <span id="scenarioBtnText">Analyze</span>
                                <i class="fas fa-bolt ml-2"></i>
                            </button>
                        </div>
                        <!-- Result Area -->
                        <div id="scenarioResult" class="hidden">
                            <div class="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <h4 class="text-emerald-400 font-bold text-sm mb-2 flex items-center"><i class="fas fa-robot mr-2"></i> Advisor Analysis:</h4>
                                <div id="scenarioText" class="text-slate-300 text-sm leading-relaxed prose prose-invert max-w-none"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategic Rationale -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-brain text-purple-500 mr-3"></i> Strategic Rationale
                    </h3>
                    <div class="grid grid-cols-1 gap-6">
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:border-blue-300 transition-colors group">
                            <div class="flex items-start">
                                <div class="bg-orange-100 p-3 rounded-lg text-orange-600 mr-4 group-hover:bg-orange-600 group-hover:text-white transition-colors">
                                    <i class="fas fa-rocket text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 text-lg">Nifty Next 50: The "Giant-in-Training"</h4>
                                    <p class="text-sm text-gray-500 font-semibold mb-2 uppercase tracking-wide">Allocated: 30% (The Alpha/Growth Engine)</p>
                                    <p class="text-gray-600 leading-relaxed mb-2">
                                        This index tracks the 50 companies just below the top 50. These are "Giants in Training." 
                                        Because they are slightly smaller, they often grow faster than the mature Nifty 50 companies. 
                                        In 2021 and 2024, for example, Nifty Next 50 outperformed Nifty 50 meaningfully, contributing 
                                        a strong performance boost to any blended portfolio that included it.
                                    </p>
                                    <p class="text-gray-600 leading-relaxed">
                                        <strong>Why it outperforms:</strong> While Nifty 50 companies are stable battleships, Next 50 
                                        companies are fast speedboats. They benefit disproportionately when the economic cycle turns up 
                                        and when they graduate into the Nifty 50 over time. From a portfolio design perspective, giving 
                                        them a <strong>30% satellite allocation</strong> allows you to participate in this upside 
                                        without turning the entire strategy into an aggressive mid/small-cap bet.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:border-yellow-300 transition-colors group">
                            <div class="flex items-start">
                                <div class="bg-yellow-100 p-3 rounded-lg text-yellow-600 mr-4 group-hover:bg-yellow-600 group-hover:text-white transition-colors">
                                    <i class="fas fa-anchor text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 text-lg">Gold: The Crisis Hedge</h4>
                                    <p class="text-sm text-gray-500 font-semibold mb-2 uppercase tracking-wide">Allocated: 20% (The Safety Net)</p>
                                    <p class="text-gray-600 leading-relaxed mb-2">
                                        Gold is your portfolio's insurance policy. It usually moves opposite to the stock market or at 
                                        least does not fall as much when equities are under pressure. In the COVID shock of 2020 and 
                                        during bouts of global uncertainty in 2022, gold held up far better than equities, cushioning 
                                        overall portfolio losses and providing a psychological anchor.
                                    </p>
                                    <p class="text-gray-600 leading-relaxed">
                                        <strong>Note on recent returns:</strong> Gold's five-year return looks high, but it is 
                                        "right-skewed" <span class="text-gray-400 italic text-sm">(most of the growth happened recently)</span>. 
                                        It was flat for several years and then spiked in the last 18–24 months due to global rate cuts, 
                                        war-related risk premia and a flight to safety. We hold gold not because we expect this spike 
                                        to repeat every year, but because it behaves differently from equities, acts as an inflation 
                                        hedge, and meaningfully reduces portfolio drawdowns when you most need protection.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Performance Simulations -->
                <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden mb-8">
                    <div class="bg-gray-50 p-6 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">Performance Simulation</h3>
                            <p class="text-sm text-gray-500">
                                Backtested on actual daily market data (2020–2025) to compare how different entry styles impact your final wealth.
                            </p>
                        </div>
                        <div class="flex bg-white rounded-lg p-1 border border-gray-200 shadow-sm">
                            <button onclick="switchChart('12')" id="btn-12" class="toggle-btn active px-4 py-2 rounded-md text-sm font-medium border border-transparent">
                                12-Month STP (Recommended)
                            </button>
                            <button onclick="switchChart('36')" id="btn-36" class="toggle-btn px-4 py-2 rounded-md text-sm font-medium border border-transparent text-gray-500">
                                36-Month STP (Too Slow)
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="h-80 relative">
                            <canvas id="simulationChart"></canvas>
                        </div>
                        <div id="chart-desc" class="mt-4 p-4 bg-blue-50 text-blue-800 rounded-lg text-sm border border-blue-100">
                            <strong>Insight:</strong> The 12-month STP (recommended) captures the market recovery efficiently. 
                            You are not exposed all at once to the COVID-style drawdowns at the start of the period, but you are 
                            still substantially invested by the time the recovery and subsequent rallies take hold. The green 
                            line (recommended portfolio) climbs steadily and overtakes the more conservative paths, 
                            reflecting a good balance between risk control and compounding.
                            <br><br>
                            In practice, this means your inheritance doesn't sit idle in cash or low-yield deposits for years. 
                            The arbitrage fund earns modest, low-risk returns while equity exposure is built systematically. 
                            The early months act like a \"trial phase\" for your risk comfort, and as confidence grows, the 
                            portfolio gradually shifts into full 50-30-20 mode.
                        </div>
                    </div>
                </div>


                <!-- Drawdown Protection -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8 mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Portfolio "Stress Test" (Drawdown)</h3>
                    <p class="text-gray-500 mb-6">
                        This chart shows how much the portfolio falls from its previous peak during bad times. 
                        It is a direct measure of \"how painful the worst period feels\" for an investor holding the strategy.
                    </p>
                    <div class="h-64 mb-6">
                        <canvas id="drawdownChart"></canvas>
                    </div>
                    <div class="border-t border-gray-100 pt-6">
                        <h4 class="font-bold text-gray-900 text-sm mb-2 uppercase tracking-wide">Analysis Note:</h4>
                        <p class="text-gray-700 leading-relaxed text-sm mb-3">
                            <strong>Drawdown explained:</strong> This measures the "peak to trough" journey of your investment. 
                            A -36% drawdown means your ₹100 became ₹64 at the worst point before recovering. Most investors are 
                            not comfortable watching a third of their nest egg disappear on screen, even if it recovers later. 
                            Deep drawdowns often trigger panic decisions like selling at the bottom.
                        </p>
                        <p class="text-gray-700 leading-relaxed text-sm">
                            Notice how the <span class="text-green-600 font-bold">green line (your 50-30-20 portfolio)</span> 
                            consistently sits above the <span class="text-red-500 font-bold">red band (pure Nifty 50)</span> 
                            during stress periods. In the COVID crash and during later volatility spikes, the mixed portfolio 
                            fell substantially less and recovered faster. This shallower valley is not only mathematically safer 
                            but also emotionally easier to live with, increasing the odds that you stay invested and allow 
                            compounding to work for you over many years.
                        </p>
                    </div>
                </div>


                <!-- Implementation Plan -->
                <div class="bg-slate-900 rounded-2xl shadow-xl p-8 text-white relative overflow-hidden mb-8">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -mr-16 -mt-16 blur-3xl"></div>
                    <h2 class="text-2xl font-bold mb-8 flex items-center relative z-10">
                        <i class="fas fa-clipboard-check mr-3 text-emerald-400"></i> Execution Checklist
                    </h2>
                    <p class="text-sm text-slate-300 mb-6 relative z-10">
                        The goal of the execution plan is to make the strategy <strong>operationally simple</strong>. 
                        Once the initial instructions are given, the system works largely on autopilot. Your main job is 
                        to review once a year, not every day. Below are the concrete steps.
                    </p>
                    <div class="space-y-8 relative z-10">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center font-bold text-white shadow-lg ring-4 ring-slate-800">1</div>
                            <div>
                                <h4 class="text-lg font-bold text-emerald-400">Day 1: Immediate Action</h4>
                                <ul class="mt-2 space-y-2 text-slate-300 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-check mt-1 mr-2 text-emerald-600"></i> 
                                        <span>Buy <strong>₹ 4,00,000</strong> of Sovereign Gold Bonds (secondary market) or a high-quality Gold ETF if SGB access is constrained.</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check mt-1 mr-2 text-emerald-600"></i> 
                                        <span>Invest the remaining <strong>₹ 16,00,000</strong> into a shortlisted <span class="text-white font-semibold">Arbitrage Fund</span> to act as your low-risk parking plus STP source.</span>
                                    </li>
                                </ul>
                                <div class="mt-2 text-xs bg-slate-800 p-2 rounded text-slate-400 inline-block">
                                    <i class="fas fa-info-circle mr-1"></i> 
                                    Arbitrage Fund = A low-risk fund that exploits price differences in cash and futures, 
                                    but is taxed like equity (12.5% LTCG) instead of like a bank deposit (up to 30% slab).
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center font-bold text-white shadow-lg ring-4 ring-slate-800">2</div>
                            <div>
                                <h4 class="text-lg font-bold text-blue-400">Day 2: Set "Autopilot" (STP)</h4>
                                <p class="text-slate-300 text-sm mb-2">
                                    Instruct the fund house to automatically transfer money from the Arbitrage Fund monthly for 12 months. 
                                    This makes the plan behaviourally robust: no manual execution pressure for you during volatile months.
                                </p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div class="bg-slate-800 p-3 rounded border border-slate-700">
                                        <p class="text-xs text-slate-500 uppercase">To Nifty 50</p>
                                        <p class="font-mono text-lg font-bold text-white">₹ 83,300 <span class="text-xs font-normal text-slate-400">/mo</span></p>
                                    </div>
                                    <div class="bg-slate-800 p-3 rounded border border-slate-700">
                                        <p class="text-xs text-slate-500 uppercase">To Nifty Next 50</p>
                                        <p class="font-mono text-lg font-bold text-white">₹ 50,000 <span class="text-xs font-normal text-slate-400">/mo</span></p>
                                    </div>
                                </div>
                                <p class="text-slate-300 text-xs mt-3">
                                    As markets move up and down during the year, this STP will automatically buy more units on weak days 
                                    and fewer units when prices are stretched, echoing the discipline of a SIP without requiring regular 
                                    cash inflows from your side.
                                </p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-sky-500 flex items-center justify-center font-bold text-white shadow-lg ring-4 ring-slate-800">3</div>
                            <div>
                                <h4 class="text-lg font-bold text-sky-300">Year 2 Onwards: Maintain & Review</h4>
                                <p class="text-slate-300 text-sm">
                                    After 12 months, the portfolio will be fully deployed in the 50-30-20 mix. From that point, 
                                    we only need one <strong>annual review</strong> to rebalance back to target weights if one 
                                    asset class runs ahead or lags. If you decide on a specific house-purchase year later, 
                                    we can gradually shift a portion of the equity sleeve into short-duration debt during the 
                                    final 3–5 years before the goal, further de-risking the plan.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Tax and Efficiency Considerations -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-hand-holding-usd text-emerald-600 mr-3"></i> Tax & Efficiency Considerations (India-Side)
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">
                        Tax rules shape how much of your <strong>gross return</strong> you actually keep. 
                        The 50-30-20 structure is built to be not only sensible from a risk–return point of view, 
                        but also efficient under the current Indian tax framework. Below is how each building block is treated.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-100">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 mr-3">
                                    <i class="fas fa-balance-scale"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">1. Arbitrage Fund for STP Parking</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
                                <li>Treated as <strong>equity mutual funds</strong> for tax purposes.</li>
                                <li>LTCG (&gt;12 months): taxed at <strong>12.5%</strong>, with an annual exemption up to ₹1.25L.</li>
                                <li>STCG (≤12 months): taxed at <strong>20%</strong>.</li>
                                <li>More favourable than new-regime debt funds, which are typically taxed at your income slab rate.</li>
                            </ul>
                        </div>
                        <div class="bg-blue-50 p-5 rounded-xl border border-blue-100">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-3">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">2. Nifty 50 & Next 50 Index Funds</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
                                <li>Also classified as <strong>equity funds</strong> with the same 12.5%/20% LTCG–STCG framework.</li>
                                <li>Indexing keeps <strong>expense ratios low</strong> and removes manager selection risk.</li>
                                <li>Simple structures; easy to explain, monitor and rebalance over time.</li>
                            </ul>
                        </div>
                        <div class="bg-yellow-50 p-5 rounded-xl border border-yellow-100">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 mr-3">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">3. Gold (SGB vs ETF)</h4>
                            </div>
                            <div class="text-sm text-gray-600 space-y-3">
                                <p>
                                    <strong>SGBs:</strong> Pay ~2.5% coupon (taxed at slab), but redemption at maturity is 
                                    <strong>tax-free</strong> for Indian residents under current rules, making them extremely 
                                    efficient for long holding periods.
                                </p>
                                <p>
                                    <strong>Gold ETFs:</strong> Treated broadly as non-equity funds. Long-term gains are generally 
                                    taxed at 12.5% beyond a threshold holding period. They offer daily liquidity and are useful 
                                    when SGB access or pricing is unattractive.
                                </p>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-5 rounded-xl border border-purple-100">
                            <div class="flex items-center mb-3">
                                <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mr-3">
                                    <i class="fas fa-globe-americas"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">4. Cross-Border (US)</h4>
                            </div>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Because you are a US tax resident, many Indian mutual funds/ETFs may be classified as 
                                <strong>PFICs</strong> under US tax law (Form 8621 reporting). The economic logic of this plan 
                                remains strong, but before execution we will align with a US-qualified tax professional to 
                                confirm how PFIC rules apply in your case and whether any wrapper-level adjustments are needed 
                                to keep compliance simple.
                            </p>
                        </div>
                    </div>
                </div>


                <!-- Footer / Risk -->
                <div class="bg-red-50 border border-red-100 rounded-lg p-4">
                    <h4 class="text-red-800 font-bold text-sm mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i> Risk Disclosure
                    </h4>
                    <p class="text-red-700 text-xs leading-relaxed mb-2">
                        All investments involve risk. Short-term volatility is expected; Nifty 50 one-year returns in the past 
                        have ranged from roughly -4% to +80% depending on entry point. The 50-30-20 structure is designed to 
                        temper, not eliminate, this variability.
                    </p>
                    <p class="text-red-700 text-xs leading-relaxed">
                        This mandate is expressed in INR while some of your eventual goals (e.g. a home in the US) may be in USD, 
                        so currency risk also applies. Past performance and backtests are not guarantees of future results. 
                        This note is for educational and planning purposes and should be read together with personalised 
                        tax and legal advice in both India and the US.
                    </p>
                </div>
            </div>


            <!-- Right Column: Sticky Sidebar -->
            <div class="w-full lg:w-80 flex-shrink-0">
                <div class="sticky-sidebar space-y-6">
                    <!-- Asset Allocation Card -->
                    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                        <h3 class="font-bold text-gray-900 mb-4 text-center">Target Allocation</h3>
                        <div class="relative w-48 h-48 mx-auto mb-6">
                            <canvas id="allocationChart"></canvas>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div class="text-center">
                                    <span class="block text-2xl font-bold text-gray-800">₹20L</span>
                                    <span class="text-xs text-gray-500">Total</span>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-2 rounded hover:bg-gray-50">
                                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span><div><p class="text-sm font-bold text-gray-900">Nifty 50</p><p class="text-xs text-gray-500">Stability</p></div></div><span class="font-mono text-sm font-bold">50%</span>
                            </div>
                            <div class="flex justify-between items-center p-2 rounded hover:bg-gray-50">
                                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span><div><p class="text-sm font-bold text-gray-900">Next 50</p><p class="text-xs text-gray-500">Growth</p></div></div><span class="font-mono text-sm font-bold">30%</span>
                            </div>
                            <div class="flex justify-between items-center p-2 rounded hover:bg-gray-50">
                                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span><div><p class="text-sm font-bold text-gray-900">Gold</p><p class="text-xs text-gray-500">Hedge</p></div></div><span class="font-mono text-sm font-bold">20%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats Card -->
                    <div class="bg-indigo-900 rounded-xl shadow-lg p-6 text-white">
                        <h4 class="font-bold text-indigo-200 text-xs uppercase tracking-wide mb-4">Projected Stats (Backtest)</h4>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-2xl font-bold">~12%</p>
                                <p class="text-xs text-indigo-300">Expected Real Return (CAGR)</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-green-400">~-24%</p>
                                <p class="text-xs text-indigo-300">Max Drawdown (Portfolio)</p>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-indigo-800 text-[10px] text-indigo-300 opacity-80 leading-tight">
                            <p class="mb-1">
                                <strong class="text-indigo-200">CAGR:</strong> Compound Annual Growth Rate – what a steady yearly growth 
                                rate would need to be to get from the starting value to the ending value of the backtest.
                            </p>
                            <p class="mb-1">
                                <strong class="text-indigo-200">Max Drawdown:</strong> The deepest decline from a previous peak in the 
                                backtest. It helps you visualise the worst "valley" in your investment journey so far.
                            </p>
                            <p>
                                These are <strong>historical, modelled numbers</strong>; reality will be different, but they offer a 
                                useful yardstick for setting expectations and choosing a portfolio that matches your temperament.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ✨ Floating Chat Widget -->
    <div id="chat-widget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        <!-- Chat Window -->
        <div id="chat-window" class="hidden w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden mb-4 flex-col transition-all duration-300">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 flex justify-between items-center text-white">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mr-2">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3 class="font-bold text-sm">Ask the Advisor</h3>
                </div>
                <button onclick="toggleChat()" class="text-white/80 hover:text-white transition"><i class="fas fa-times"></i></button>
            </div>
            <div id="chat-messages" class="h-80 overflow-y-auto p-4 bg-slate-50 space-y-3 text-sm">
                <!-- Welcome Message -->
                <div class="flex items-start">
                    <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-2 mt-1 flex-shrink-0"><i class="fas fa-robot text-xs"></i></div>
                    <div class="bg-white border border-gray-200 p-3 rounded-r-xl rounded-bl-xl shadow-sm text-gray-700">
                        Hello! I am your Wealth Advisor. Ask me anything about the "50-30-20 Shield" strategy, tax efficiency, or why we chose these specific funds.
                    </div>
                </div>
            </div>
            <div class="p-3 bg-white border-t border-gray-100 flex gap-2">
                <input type="text" id="chatInput" placeholder="Ask a question..." class="flex-1 bg-gray-100 border-0 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 text-sm" onkeypress="handleChatEnter(event)">
                <button onclick="sendChatMessage()" class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-3 py-2 transition"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Floating Button -->
        <button onclick="toggleChat()" class="bg-blue-600 hover:bg-blue-700 text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center transition-transform hover:scale-105 focus:outline-none ring-4 ring-blue-600/20">
            <i class="fas fa-comments text-xl"></i>
        </button>
    </div>

    <script>
        // --- GEMINI API SETUP ---
        const apiKey = ""; // Environment variable in real app
        const md = window.markdownit();

        async function callGemini(prompt) {
            if (!apiKey) {
                console.warn("API Key missing");
                return "Simulated Response (Add API Key to enable): Based on the 50-30-20 strategy, this portfolio is designed to withstand volatility through Gold hedging while capturing growth via Nifty Next 50.";
            }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const systemContext = `You are a Senior Wealth Advisor. You have designed a portfolio called 'The 50-30-20 Shield' for a risk-averse client (US Post-doc with 20L INR). 
            Allocation: 50% Nifty 50, 30% Nifty Next 50, 20% Gold (SGB). 
            Strategy: 12-month STP from Arbitrage Fund.
            Goal: Capital Protection #1, Growth #2.
            Key Data: Gold protects downside (2020 crash). Nifty Next 50 provides alpha. 12-month STP beats lumpsum in safety.
            Task: Answer the user's question based on this specific strategy. Be professional, concise, and empathetic.`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            role: "user",
                            parts: [{ text: systemContext + "\n\nUser Question: " + prompt }]
                        }]
                    })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "I apologize, I am currently unable to connect to the strategy server. Please try again later.";
            }
        }

        // --- AI SCENARIO LOGIC ---
        async function analyzeScenario() {
            const input = document.getElementById('scenarioInput');
            const btn = document.getElementById('scenarioBtn');
            const btnText = document.getElementById('scenarioBtnText');
            const resultArea = document.getElementById('scenarioResult');
            const resultText = document.getElementById('scenarioText');
            const query = input.value.trim();

            if (!query) return;

            // Loading State
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            btnText.innerText = "Thinking...";
            resultArea.classList.add('hidden');

            // Call API
            const prompt = `Analyze how the '50-30-20 Shield' portfolio (50% Nifty50, 30% Next50, 20% Gold) would react to this scenario: "${query}". Explain which part of the portfolio (Gold or Equity) would help. Keep it under 100 words.`;
            const response = await callGemini(prompt);

            // Render Result
            resultText.innerHTML = md.render(response);
            resultArea.classList.remove('hidden');
            
            // Reset Button
            btn.disabled = false;
            btn.classList.remove('opacity-75', 'cursor-not-allowed');
            btnText.innerText = "Analyze";
        }

        // --- CHAT WIDGET LOGIC ---
        function toggleChat() {
            const chatWindow = document.getElementById('chat-window');
            chatWindow.classList.toggle('hidden');
            if (!chatWindow.classList.contains('hidden')) {
                document.getElementById('chatInput').focus();
            }
        }

        function handleChatEnter(e) {
            if (e.key === 'Enter') sendChatMessage();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chat-messages');
            const userText = input.value.trim();

            if (!userText) return;

            // Add User Message
            messages.innerHTML += `
                <div class="flex items-start justify-end chat-enter">
                    <div class="bg-blue-600 text-white p-3 rounded-l-xl rounded-br-xl shadow-sm max-w-[80%] text-left">
                        ${userText}
                    </div>
                </div>`;
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            // Add Typing Indicator
            const loadingId = 'loading-' + Date.now();
            messages.innerHTML += `
                <div id="${loadingId}" class="flex items-start chat-enter">
                    <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-2 mt-1 flex-shrink-0"><i class="fas fa-robot text-xs"></i></div>
                    <div class="bg-white border border-gray-200 p-3 rounded-r-xl rounded-bl-xl shadow-sm flex space-x-1 h-10 items-center">
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    </div>
                </div>`;
            messages.scrollTop = messages.scrollHeight;

            // Call API
            const aiResponse = await callGemini(userText);

            // Remove Typing Indicator & Add AI Message
            document.getElementById(loadingId).remove();
            messages.innerHTML += `
                <div class="flex items-start chat-enter">
                    <div class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-2 mt-1 flex-shrink-0"><i class="fas fa-robot text-xs"></i></div>
                    <div class="bg-white border border-gray-200 p-3 rounded-r-xl rounded-bl-xl shadow-sm text-gray-700 max-w-[85%]">
                        ${md.render(aiResponse)}
                    </div>
                </div>`;
            messages.scrollTop = messages.scrollHeight;
        }

        // Data injected from Analysis
        const chartsData = {
            "stp_12": {
                "labels": ["2020-01-01", "2020-01-21", "2020-02-07", "2020-02-28", "2020-03-20", "2020-04-15", "2020-05-06", "2020-05-27", "2020-06-16", "2020-07-06", "2020-07-24", "2020-08-13", "2020-09-02", "2020-09-22", "2020-10-13", "2020-11-02", "2020-11-20", "2020-12-11", "2021-01-01", "2021-01-21", "2021-02-11", "2021-03-03", "2021-03-24", "2021-04-16", "2021-05-07", "2021-05-28", "2021-06-17", "2021-07-07", "2021-07-28", "2021-08-17", "2021-09-07", "2021-09-28", "2021-10-19", "2021-11-09", "2021-11-30", "2021-12-20", "2022-01-07", "2022-01-28", "2022-02-17", "2022-03-10", "2022-03-31", "2022-04-22", "2022-05-13", "2022-06-02", "2022-06-22", "2022-07-12", "2022-08-01", "2022-08-23", "2022-09-13", "2022-10-03", "2022-10-24", "2022-11-15", "2022-12-05", "2022-12-23", "2023-01-12", "2023-02-02", "2023-02-22", "2023-03-15", "2023-04-06", "2023-04-28", "2023-05-19", "2023-06-08", "2023-06-28", "2023-07-19", "2023-08-08", "2023-08-29", "2023-09-18", "2023-10-10", "2023-10-31", "2023-11-20", "2023-12-11", "2024-01-01", "2024-01-19", "2024-02-09", "2024-02-29", "2024-03-20", "2024-04-12", "2024-05-06", "2024-05-24", "2024-06-13", "2024-07-04", "2024-07-25", "2024-08-14", "2024-09-04", "2024-09-24", "2024-10-15", "2024-11-04", "2024-11-26", "2024-12-16", "2025-01-06", "2025-01-24", "2025-02-12", "2025-03-05", "2025-03-26", "2025-04-21", "2025-05-12", "2025-05-30", "2025-06-19", "2025-07-09", "2025-07-29", "2025-08-19", "2025-09-09", "2025-09-29", "2025-10-20", "2025-11-11"],
                "datasets": [
                    {"label": "Rec. Portfolio (Total)", "data": [2000000.0, 2012951.02, 2027961.36, 2029816.35, 1939454.35, 2036010.66, 2040380.3, 2019088.84, 2080484.88, 2146156.12, 2205187.92, 2247449.93, 2249747.73, 2200642.89, 2282260.32, 2265672.0, 2412265.35, 2499741.86, 2581050.1, 2649718.95, 2706701.39, 2713911.27, 2620072.14, 2652186.11, 2703480.17, 2806397.81, 2857661.15, 2880792.59, 2871736.43, 2968612.89, 3098425.39, 3131490.28, 3244518.89, 3205547.11, 3069990.75, 3010356.3, 3157095.12, 3048863.36, 3100826.92, 3025036.95, 3129454.25, 3160951.37, 2891958.76, 3004198.05, 2821873.42, 2954549.8, 3138554.08, 3193741.54, 3285402.57, 3089462.84, 3188203.48, 3304670.03, 3356633.45, 3210659.51, 3257515.19, 3182922.47, 3136555.48, 3083188.62, 3194545.38, 3252233.89, 3301721.84, 3383473.41, 3420349.62, 3547175.48, 3529862.12, 3488052.7, 3610229.43, 3530115.33, 3489981.67, 3603236.26, 3837427.71, 3982133.24, 3990749.62, 4068794.27, 4131817.17, 4116362.72, 4385946.37, 4404437.11, 4564122.68, 4640858.92, 4790434.43, 4762163.17, 4733017.34, 4929795.57, 5064044.12, 4972755.79, 4751103.64, 4741671.54, 4877700.09, 4653164.29, 4523145.32, 4527514.99, 4439528.46, 4627242.46, 4844198.44, 4883698.22, 4937553.5, 4952336.63, 5059417.93, 4999350.23, 5033282.87, 5115493.62, 5162419.17, 5424246.78, 5400216.34], "borderColor": "#10B981", "borderWidth": 3, "order": 1},
                    {"label": "Nifty 50 (Invested)", "data": [1000000.0, 1001147.27, 1001954.43, 1001996.49, 1005573.47, 1005394.45, 995769.24, 981173.55, 945046.19, 943816.81, 956613.24, 962971.44, 967576.5, 962855.91, 969284.89, 1006839.68, 996166.95, 1014367.09, 1041339.86, 1034825.52, 1067458.74, 1063953.91, 1079428.67, 1088967.03, 1094297.77, 1090417.3, 1069012.59, 1087510.32, 1127888.4, 1125941.54, 1108624.18, 1201512.59, 1211098.27, 1235263.1, 1269789.93, 1268854.87, 1318852.89, 1368850.93, 1374956.18, 1375672.62, 1427495.98, 1385101.9, 1435534.65, 1409307.08, 1375691.64, 1387012.04, 1378602.42, 1400179.01, 1396984.43, 1415605.91, 1453435.96, 1484312.7, 1486246.29, 1495480.89, 1500804.26, 1509082.83, 1491112.64, 1539025.16, 1574334.81, 1585916.3, 1646171.03, 1669225.54, 1683327.67, 1686652.19, 1743951.86, 1702862.1, 1713313.84, 1689520.52, 1616184.83, 1663489.22, 1583461.01, 1637284.19, 1692063.48, 1722940.76, 1628484.51, 1643369.21, 1644434.22, 1600215.77, 1581203.12, 1648063.96, 1661384.29, 1685743.03, 1637265.8, 1593482.07, 1509629.88, 1541724.29, 1590332.85, 1513781.72, 1480862.68, 1511827.28, 1541922.73, 1589227.67, 1659565.5, 1691833.94, 1690552.65, 1685533.97, 1731969.87, 1696965.07, 1621631.04, 1638863.08, 1699205.72, 1735907.1, 1766524.35, 1773587.27, 1797251.26], "borderColor": "#3B82F6", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0},
                    {"label": "Nifty Next 50 (Invested)", "data": [600000.0, 601913.62, 606667.36, 598879.71, 573913.24, 582512.4, 591173.52, 576441.5, 596981.68, 612589.18, 614643.29, 632475.4, 631432.48, 616230.0, 633615.0, 637455.38, 691006.96, 732601.12, 752037.08, 771473.11, 792917.19, 820385.35, 791629.4, 798125.16, 826262.83, 861317.02, 889901.03, 894165.9, 898877.06, 914743.87, 974117.53, 983067.99, 1020799.92, 1006993.09, 970428.92, 939442.6, 986545.46, 937933.42, 951123.41, 922145.33, 954299.94, 995825.31, 876710.24, 901725.45, 832364.44, 904679.47, 964054.08, 989069.53, 1046882.47, 965473.72, 982680.44, 1012381.48, 1022671.85, 950410.93, 978550.37, 898034.43, 881997.86, 875332.04, 893654.81, 920009.66, 945249.02, 994807.62, 1013130.64, 1037700.85, 1044645.29, 1032402.17, 1073036.62, 1052092.27, 1028916.87, 1091416.46, 1195861.13, 1246089.7, 1275568.93, 1336953.21, 1381604.18, 1346381.18, 1474476.09, 1517119.24, 1617325.29, 1651267.21, 1703727.48, 1685684.48, 1676119.79, 1766509.26, 1794204.37, 1775046.07, 1626929.23, 1630082.24, 1710432.0, 1579941.18, 1467745.6, 1428284.52, 1398640.43, 1466942.49, 1533682.83, 1528804.35, 1573456.75, 1550283.24, 1614792.73, 1588495.79, 1601466.59, 1592795.62, 1601973.65, 1640379.4, 1646880.23], "borderColor": "#F97316", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0},
                    {"label": "Gold (Invested)", "data": [400000.0, 409082.96, 415720.52, 435167.39, 420494.9, 496885.0, 481630.27, 473362.44, 487336.24, 492227.07, 523085.88, 535545.85, 524017.46, 515400.29, 520756.91, 519592.43, 510160.11, 497350.8, 510160.11, 503289.66, 486288.2, 457991.26, 452751.09, 475458.51, 480232.89, 491644.83, 481513.82, 485822.41, 481746.72, 479534.2, 478136.82, 465094.61, 479767.1, 485240.17, 483377.0, 487452.69, 478486.17, 482445.41, 505269.28, 521688.5, 513770.01, 527860.26, 505618.63, 512139.73, 508646.28, 507947.59, 514934.49, 514119.35, 506550.21, 502358.07, 506317.32, 525764.19, 536710.33, 543697.23, 558369.72, 587714.7, 560815.13, 569781.65, 603318.77, 596797.67, 599010.18, 590393.01, 577001.45, 594119.35, 588762.73, 582008.73, 587365.35, 569781.65, 606229.98, 601572.05, 605764.19, 625793.3, 615312.95, 617758.36, 614614.26, 648850.07, 720931.58, 707074.23, 709053.85, 705560.4, 713711.79, 691353.71, 694148.47, 696710.33, 733508.0, 743639.01, 768791.84, 738165.93, 750858.8, 752372.63, 789170.3, 832256.18, 841572.05, 852983.98, 944046.57, 908064.04, 925647.74, 964075.69, 931935.95, 953828.23, 958486.17, 1061659.38, 1116739.44, 1224337.7, 1202794.75], "borderColor": "#EAB308", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0}
                ]
            },
            "stp_36": {
                "labels": ["2020-01-01", "2020-01-21", "2020-02-07", "2020-02-28", "2020-03-20", "2020-04-15", "2020-05-06", "2020-05-27", "2020-06-16", "2020-07-06", "2020-07-24", "2020-08-13", "2020-09-02", "2020-09-22", "2020-10-13", "2020-11-02", "2020-11-20", "2020-12-11", "2021-01-01", "2021-01-21", "2021-02-11", "2021-03-03", "2021-03-24", "2021-04-16", "2021-05-07", "2021-05-28", "2021-06-17", "2021-07-07", "2021-07-28", "2021-08-17", "2021-09-07", "2021-09-28", "2021-10-19", "2021-11-09", "2021-11-30", "2021-12-20", "2022-01-07", "2022-01-28", "2022-02-17", "2022-03-10", "2022-03-31", "2022-04-22", "2022-05-13", "2022-06-02", "2022-06-22", "2022-07-12", "2022-08-01", "2022-08-23", "2022-09-13", "2022-10-03", "2022-10-24", "2022-11-15", "2022-12-05", "2022-12-23", "2023-01-12", "2023-02-02", "2023-02-22", "2023-03-15", "2023-04-06", "2023-04-28", "2023-05-19", "2023-06-08", "2023-06-28", "2023-07-19", "2023-08-08", "2023-08-29", "2023-09-18", "2023-10-10", "2023-10-31", "2023-11-20", "2023-12-11", "2024-01-01", "2024-01-19", "2024-02-09", "2024-02-29", "2024-03-20", "2024-04-12", "2024-05-06", "2024-05-24", "2024-06-13", "2024-07-04", "2024-07-25", "2024-08-14", "2024-09-04", "2024-09-24", "2024-10-15", "2024-11-04", "2024-11-26", "2024-12-16", "2025-01-06", "2025-01-24", "2025-02-12", "2025-03-05", "2025-03-26", "2025-04-21", "2025-05-12", "2025-05-30", "2025-06-19", "2025-07-09", "2025-07-29", "2025-08-19", "2025-09-09", "2025-09-29", "2025-10-20", "2025-11-11"],
                "datasets": [
                    {"label": "Portfolio (36-Month STP)", "data": [2000000.0, 2012758.95, 2024579.41, 2040559.65, 2003060.01, 2088580.25, 2082280.44, 2072090.25, 2104295.73, 2131876.39, 2174561.32, 2199395.88, 2194922.27, 2175260.71, 2208494.6, 2204651.33, 2249695.58, 2272788.39, 2310909.74, 2333238.85, 2347529.36, 2336329.7, 2298104.41, 2326285.49, 2353361.37, 2406905.68, 2426461.53, 2441609.98, 2437020.91, 2484988.76, 2550978.36, 2563157.95, 2631863.79, 2615948.76, 2542562.32, 2511772.83, 2592183.94, 2532193.91, 2572533.65, 2534809.29, 2597025.75, 2622995.16, 2441417.0, 2517665.21, 2395416.18, 2486204.83, 2615420.8, 2654665.02, 2718970.82, 2576887.09, 2650975.45, 2742885.27, 2784827.12, 2673893.02, 2713758.94, 2662597.78, 2620744.29, 2582071.95, 2675604.05, 2718770.36, 2757691.94, 2819107.91, 2844621.54, 2946233.39, 2931992.19, 2898407.18, 2993924.76, 2928358.43, 2906037.07, 2992678.89, 3174553.25, 3290891.62, 3295612.24, 3356952.19, 3405251.9, 3401140.71, 3626355.74, 3638026.86, 3762291.88, 3820861.81, 3938177.38, 3911223.44, 3889615.25, 4042278.45, 4154238.46, 4086648.57, 3921008.83, 3906832.39, 4015230.11, 3842084.02, 3749818.01, 3762905.72, 3697510.6, 3845009.87, 4033550.17, 4055468.28, 4101619.35, 4121813.45, 4197324.82, 4156299.98, 4183734.09, 4270928.38, 4320080.61, 4546461.37, 4523292.71], "borderColor": "#F59E0B", "borderWidth": 3, "order": 1},
                    {"label": "Nifty 50 (Invested)", "data": [1000000.0, 1003789.47, 1005935.21, 1010391.11, 1009697.23, 987033.39, 976130.12, 986059.45, 2000570.56, 1995329.46, 2008134.47, 2022517.28, 2039063.7, 2056060.32, 2075108.96, 2080513.91, 2090175.82, 2092278.97, 2101672.47, 2103234.84, 2127556.2, 2117873.1, 2185111.28, 2205721.9, 2235880.22, 2265116.69, 2306201.0, 2261430.97, 2353743.43, 2354572.25, 2349398.14, 2314087.94, 2316891.03, 2344830.73, 2335056.8, 2394150.7, 2429415.32, 2439627.65, 2430833.91, 2442468.12, 2487825.39, 2524115.14, 2592610.74, 2616460.58, 2622646.92, 2678047.64, 2656529.65, 2610012.36, 2558310.93, 2529506.88, 2635981.45, 2710556.6, 2628039.43, 2607293.35, 2530934.68, 2569813.75, 2626259.85, 2597822.25, 2586577.66, 2489844.65, 2529199.85, 2431060.5, 2447372.09, 2477445.14, 2535180.83, 2668594.06, 2678147.88, 2713756.96, 2652444.37, 2643145.28, 2699904.17, 2766026.27, 2781828.33, 2825164.23, 2779189.33, 2756368.23, 2769611.28, 2693429.42, 2752715.0, 2654178.9, 2620979.06, 2662967.4, 2695506.18, 2760249.23, 2786801.39, 2840500.39, 2878630.4, 2953488.0, 3009982.0, 3024160.0, 2983513.0, 2965754.0, 3059510.0, 3024719.0, 3038766.0, 2932117.0, 2981162.0, 3037792.0, 3215119.0, 3283726.0, 3295246.0, 3256732.0, 3356479.0, 3376916.0, 3423302.0, 3346864.0, 3446479.0, 3430323.0, 3422817.0, 3464547.0, 3477268.0, 3616141.0, 3733591.0, 3770532.0, 3802683.0, 3786130.0, 3879761.0, 3904194.0, 3972409.0, 3858848.0, 3776028.0, 3690945.0, 3697815.0, 3783464.0, 3681083.0, 3625810.0, 3572400.0, 3654856.0, 3555005.0, 3501863.0, 3662566.0, 3500705.0, 3712642.0, 3850059.0, 3862921.0, 3882571.0, 3876272.0, 3945824.0, 3895346.0, 3850191.0, 3891799.0, 3851835.0, 3945740.0, 3873174.0, 3982384.0, 4014280.0, 4052962.0], "borderColor": "#3B82F6", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0},
                    {"label": "Nifty Next 50 (Invested)", "data": [600000.0, 601532.86, 604014.43, 602317.54, 594896.4, 598665.81, 602457.89, 598454.29, 606210.12, 612323.75, 613921.63, 620780.88, 621350.51, 617202.33, 623918.7, 626122.27, 644898.29, 659690.59, 667098.89, 674908.75, 684369.67, 696148.96, 685480.98, 688864.7, 701944.01, 718185.63, 732030.78, 734804.51, 737750.61, 746068.88, 776536.58, 781770.47, 802533.66, 796214.45, 776614.4, 759566.94, 786939.69, 758946.75, 766922.67, 749755.23, 770125.99, 796810.59, 719275.93, 736129.49, 689613.19, 739534.63, 781012.96, 799033.31, 840861.94, 781733.25, 794706.31, 817167.65, 825108.71, 768859.01, 790851.09, 728168.57, 715734.73, 710603.62, 724946.17, 745548.23, 765281.13, 803966.07, 818309.38, 837521.24, 842997.56, 833521.23, 865252.33, 848995.45, 831000.07, 879771.03, 961229.78, 1000438.27, 1023477.03, 1071379.42, 1106241.75, 1078858.75, 1178748.92, 1212047.0, 1290203.8, 1316721.35, 1357670.32, 1343676.52, 1336289.99, 1406797.49, 1428447.68, 1413585.33, 1298226.23, 1300751.3, 1363435.66, 1261812.91, 1174447.71, 1143764.4, 1120731.58, 1174027.98, 1226107.49, 1222374.88, 1257241.65, 1239252.1, 1289593.74, 1269170.42, 1279348.46, 1272661.31, 1279883.98, 1309883.85, 1315020.5], "borderColor": "#F97316", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0},
                    {"label": "Gold (Invested)", "data": [400000.0, 409082.96, 415720.52, 435167.39, 420494.9, 496885.0, 481630.27, 473362.44, 487336.24, 492227.07, 523085.88, 535545.85, 524017.46, 515400.29, 520756.91, 519592.43, 510160.11, 497350.8, 510160.11, 503289.66, 486288.2, 457991.26, 452751.09, 475458.51, 480232.89, 491644.83, 481513.82, 485822.41, 481746.72, 479534.2, 478136.82, 465094.61, 479767.1, 485240.17, 483377.0, 487452.69, 478486.17, 482445.41, 505269.28, 521688.5, 513770.01, 527860.26, 505618.63, 512139.73, 508646.28, 507947.59, 514934.49, 514119.35, 506550.21, 502358.07, 506317.32, 525764.19, 536710.33, 543697.23, 558369.72, 587714.7, 560815.13, 569781.65, 603318.77, 596797.67, 599010.18, 590393.01, 577001.45, 594119.35, 588762.73, 582008.73, 587365.35, 569781.65, 606229.98, 601572.05, 605764.19, 625793.3, 615312.95, 617758.36, 614614.26, 648850.07, 720931.58, 707074.23, 709053.85, 705560.4, 713711.79, 691353.71, 694148.47, 696710.33, 733508.0, 743639.01, 768791.84, 738165.93, 750858.8, 752372.63, 789170.3, 832256.18, 841572.05, 852983.98, 944046.57, 908064.04, 925647.74, 964075.69, 931935.95, 953828.23, 958486.17, 1061659.38, 1116739.44, 1224337.7, 1202794.75], "borderColor": "#EAB308", "borderDash": [5, 5], "borderWidth": 1, "pointRadius": 0}
                ]
            },
            "drawdown": {
                "labels": ["2020-01-01", "2020-01-21", "2020-02-07", "2020-02-28", "2020-03-20", "2020-04-15", "2020-05-06", "2020-05-27", "2020-06-16", "2020-07-06", "2020-07-24", "2020-08-13", "2020-09-02", "2020-09-22", "2020-10-13", "2020-11-02", "2020-11-20", "2020-12-11", "2021-01-01", "2021-01-21", "2021-02-11", "2021-03-03", "2021-03-24", "2021-04-16", "2021-05-07", "2021-05-28", "2021-06-17", "2021-07-07", "2021-07-28", "2021-08-17", "2021-09-07", "2021-09-28", "2021-10-19", "2021-11-09", "2021-11-30", "2021-12-20", "2022-01-07", "2022-01-28", "2022-02-17", "2022-03-10", "2022-03-31", "2022-04-22", "2022-05-13", "2022-06-02", "2022-06-22", "2022-07-12", "2022-08-01", "2022-08-23", "2022-09-13", "2022-10-03", "2022-10-24", "2022-11-15", "2022-12-05", "2022-12-23", "2023-01-12", "2023-02-02", "2023-02-22", "2023-03-15", "2023-04-06", "2023-04-28", "2023-05-19", "2023-06-08", "2023-06-28", "2023-07-19", "2023-08-08", "2023-08-29", "2023-09-18", "2023-10-10", "2023-10-31", "2023-11-20", "2023-12-11", "2024-01-01", "2024-01-19", "2024-02-09", "2024-02-29", "2024-03-20", "2024-04-12", "2024-05-06", "2024-05-24", "2024-06-13", "2024-07-04", "2024-07-25", "2024-08-14", "2024-09-04", "2024-09-24", "2024-10-15", "2024-11-04", "2024-11-26", "2024-12-16", "2025-01-06", "2025-01-24", "2025-02-12", "2025-03-05", "2025-03-26", "2025-04-21", "2025-05-12", "2025-05-30", "2025-06-19", "2025-07-09", "2025-07-29", "2025-08-19", "2025-09-09", "2025-09-29", "2025-10-20", "2025-11-11"],
                "datasets": [
                    {"label": "Rec. Portfolio", "data": [0.0, -0.35, 0.0, -1.32, -5.71, -1.02, -1.42, -2.45, -0.26, 0.0, 0.0, -1.17, -1.07, -3.22, 0.0, -0.92, -0.28, -0.14, 0.0, -0.58, 0.0, -0.49, -3.93, -2.76, -0.88, 0.0, -1.12, -0.32, -0.87, -0.57, -0.16, -0.79, -0.35, -1.55, -5.71, -7.54, -3.04, -6.36, -4.76, -7.09, -3.88, -2.92, -11.18, -7.73, -13.33, -9.26, -3.61, -1.91, 0.0, -5.96, -2.95, 0.0, -0.04, -4.51, -3.12, -5.33, -6.71, -8.3, -4.99, -3.27, -1.8, -0.48, -0.27, 0.0, -0.83, -2.01, -0.05, -2.27, -3.38, -0.28, 0.0, 0.0, -1.33, -0.42, -0.47, -2.88, -0.09, -1.08, 0.0, 0.0, 0.0, -1.97, -2.85, -0.11, 0.0, -2.78, -7.11, -7.29, -4.64, -9.03, -11.57, -11.48, -13.2, -9.53, -5.29, -4.52, -3.47, -3.18, -1.08, -2.26, -1.59, 0.0, -1.59, -0.27, -0.73], "borderColor": "#10B981", "backgroundColor": "rgba(16, 185, 129, 0.1)", "fill": true},
                    {"label": "Pure Nifty 50", "data": [0.0, -1.46, -2.28, -9.07, -29.13, -27.43, -24.91, -24.84, -19.8, -12.88, -9.29, -8.15, -6.43, -9.36, -3.17, -5.19, -0.65, -0.33, 0.0, -0.46, 0.0, -0.57, -4.78, -4.58, -3.29, 0.0, -0.86, 0.0, -1.2, 0.0, -0.2, -0.7, -0.25, -2.02, -7.64, -9.54, -3.26, -6.94, -6.02, -9.68, -5.04, -6.44, -13.83, -9.16, -15.49, -11.97, -5.16, -3.37, -0.98, -7.37, -2.88, 0.0, -0.53, -5.05, -4.83, -6.14, -6.33, -9.45, -6.13, -4.01, -2.78, -0.5, 0.0, 0.0, -1.69, -2.89, -0.29, -2.44, -3.52, 0.0, -0.31, 0.0, -1.22, -0.4, -0.73, -3.76, -0.62, -1.56, 0.0, 0.0, 0.0, -2.04, -2.65, -0.02, 0.0, -1.84, -5.39, -4.44, -3.15, -1.99, -1.11, -1.43, -1.03, -0.7, -2.85, -1.72, -1.87, -2.65, -2.05, -1.49, -0.69, 0.0, -2.42, -0.95, -0.81], "borderColor": "#EF4444", "backgroundColor": "rgba(239, 68, 68, 0.1)", "fill": true}
                ]
            }
        };

        // Common Config
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: { 
                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) label += ': ';
                            if (context.parsed.y !== null) {
                                label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumSignificantDigits: 3 }).format(context.parsed.y);
                            }
                            return label;
                        }
                    }
                }
            },
            elements: { point: { radius: 0 } },
            scales: {
                x: { ticks: { maxTicksLimit: 6 } },
                y: { grid: { borderDash: [2, 4] }, ticks: { callback: function(value) { return '₹' + value/100000 + 'L'; } } }
            }
        };

        // Render Charts
        let simulationChart = null;

        function renderSimChart(datasetKey) {
            const ctx = document.getElementById('simulationChart').getContext('2d');
            if(simulationChart) simulationChart.destroy();
            simulationChart = new Chart(ctx, {
                type: 'line',
                data: chartsData[datasetKey],
                options: commonOptions
            });
        }

        function switchChart(type) {
            document.querySelectorAll('.toggle-btn').forEach(b => {
                b.classList.remove('active', 'text-white', 'border-blue-600');
                b.classList.add('text-gray-500', 'border-transparent');
            });
            document.getElementById(`btn-${type}`).classList.add('active', 'text-white', 'border-blue-600');
            document.getElementById(`btn-${type}`).classList.remove('text-gray-500', 'border-transparent');
            
            const key = type === '12' ? 'stp_12' : 'stp_36';
            renderSimChart(key);
            
            const desc = document.getElementById('chart-desc');
            if(type === '12') {
                desc.innerHTML = `<strong>Insight:</strong> The 12-Month STP (Recommended) captures the market recovery efficiently. Notice how the Orange line (Nifty Next 50) accelerates in the later years, driving portfolio growth.`;
                desc.className = "mt-4 p-4 bg-blue-50 text-blue-800 rounded-lg text-sm border border-blue-100";
            } else {
                desc.innerHTML = `<strong>Insight:</strong> The 36-Month STP keeps money in the bank (Liquid Fund) for too long. While safe, you miss the growth (Orange Line) during the 2021/2023 rallies, ending with a lower total value.`;
                desc.className = "mt-4 p-4 bg-yellow-50 text-yellow-800 rounded-lg text-sm border border-yellow-100";
            }
        }

        // Initial Load
        renderSimChart('stp_12');

        // Drawdown Chart
        new Chart(document.getElementById('drawdownChart'), {
            type: 'line',
            data: chartsData.drawdown,
            options: {
                ...commonOptions,
                scales: {
                    x: { ticks: { maxTicksLimit: 6 } },
                    y: { 
                        grid: { borderDash: [2, 4] },
                        title: { display: true, text: 'Drawdown %' },
                        ticks: { callback: function(value) { return value + '%'; } }
                    }
                }
            }
        });

        // Asset Allocation Donut
        new Chart(document.getElementById('allocationChart'), {
            type: 'doughnut',
            data: {
                labels: ['Nifty 50', 'Next 50', 'Gold'],
                datasets: [{
                    data: [50, 30, 20],
                    backgroundColor: ['#3B82F6', '#F97316', '#EAB308'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: { cutout: '70%', plugins: { legend: { display: false } } }
        });
    </script>
</body>

</html>

